<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pathroutr">
<title>Re-routing Harbor Seal Movement Tracks Around Land with {pathroutr} • pathroutr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Re-routing Harbor Seal Movement Tracks Around Land with {pathroutr}">
<meta property="og:description" content="pathroutr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pathroutr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/akharborseal_demo.html">Re-routing Harbor Seal Movement Tracks Around Land with {pathroutr}</a>
    <a class="dropdown-item" href="../articles/reroute_demo.html">Re-routing Straight Line Paths Around Barriers - A Visibility Graph Demo</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Re-routing Harbor Seal Movement Tracks Around Land with {pathroutr}</h1>
            
      
      
      <div class="d-none name"><code>akharborseal_demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="alaska-harbor-seal-example">Alaska Harbor Seal Example<a class="anchor" aria-label="anchor" href="#alaska-harbor-seal-example"></a>
</h2>
<div class="section level3">
<h3 id="essential-packages">Essential Packages<a class="anchor" aria-label="anchor" href="#essential-packages"></a>
</h3>
<p>This example relies on a non-release version of
<code>{crawl}</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># not run</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'NMML/crawl@devel'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">crawl</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/" class="external-link">sfnetworks</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pathroutr</span><span class="op">)</span></span></code></pre></div>
<p>Additional packages we’ll want to load</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/" class="external-link">ggspatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>The purpose of this is to demonstrate a more ‘real world’ use of
<code>{pathroutr}</code> for re-routing of marine animal movement around
land features. Here, we will use the Alaska harbor seal data provided in
the <code>{crawl}</code> package to:</p>
<ol style="list-style-type: decimal">
<li>demonstrate the data wrangling and pre-processing needed</li>
<li>use <code>{crawl</code>}’s movement model to predict the most likely
path</li>
<li>re-route the predicted path around any land barriers</li>
<li>repeat the process but using <code>{crawl}</code>’s multiple
imputation functionality to create a set of possible predicted paths
that span model uncertainty</li>
</ol>
</div>
<div class="section level3">
<h3 id="pre-processing-track-data-and-land-polygon-data">Pre-processing Track Data and Land Polygon Data<a class="anchor" aria-label="anchor" href="#pre-processing-track-data-and-land-polygon-data"></a>
</h3>
<p>For our land data, we will source in the Alaska 1:250000 coastal data
polygon. This is provided by the Alaska Department of Natural Resources
and was obtained from their open data portal (<a href="https://gis.data.alaska.gov/datasets/alaska-1250000" class="external-link uri">https://gis.data.alaska.gov/datasets/alaska-1250000</a>).
The commented code provides a query to pull the data directly from the
portal API. Note, only those polygons that intersect with the bounding
box of our harbor seal movement are included.</p>
<p>NOTE: because this step is time consuming, we will load directly from
package data</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># akcoast_qry &lt;- "https://arcgis.dnr.alaska.gov/arcgis/rest/services/OpenData/Physical_AlaskaCoast/MapServer/2/query?where=1%3D1&amp;outFields=*&amp;geometry=-159.240%2C55.112%2C-152.422%2C59.413&amp;geometryType=esriGeometryEnvelope&amp;inSR=4326&amp;spatialRel=esriSpatialRelIntersects&amp;outSR=3338&amp;f=json"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># akcoast &lt;- sf::read_sf(akcoast_qry)</span></span>
<span><span class="co"># akcoast &lt;- sf::st_make_valid(akcoast)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"akcoast"</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s load in our harbor seal data from the <code>{crawl}</code>
package. The <code>harborSeal_sf</code> data is only available in the
<em>devel</em> branch. We also transform to EPSG:3338.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"harborSeal_sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">harborSeal_sf</span> <span class="op">&lt;-</span> <span class="va">harborSeal_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3338</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot things to make sure everything looks good. The
<code>harborSeal_sf</code> data has missing values in the
<em>geometry</em> field so we need to filter those out when making a
line.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="va">harborSeal_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_query.html" class="external-link">st_is_empty</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">'LINESTRING'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">akcoast</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">l</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">harborSeal_sf</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-7-1.png" alt="Movement data from a harbor seal in Alaska. Raw Argos observations and the derived connect-the-dots trackline" width="700"><p class="caption">
Movement data from a harbor seal in Alaska. Raw Argos observations and
the derived connect-the-dots trackline
</p>
</div>
</div>
<div class="section level3">
<h3 id="re-route-raw-argos-observations">Re-Route Raw Argos Observations<a class="anchor" aria-label="anchor" href="#re-route-raw-argos-observations"></a>
</h3>
<p>While the preferred approach would be to rely on a movement model for
predicting the path of our seal, it can sometimes be useful to just
correct the raw observations. So, that’s what we’ll do first.</p>
<div class="section level4">
<h4 id="limit-barrier-polygon-to-region-of-interest">Limit Barrier Polygon to Region of Interest<a class="anchor" aria-label="anchor" href="#limit-barrier-polygon-to-region-of-interest"></a>
</h4>
<p>With such a large geographic area, the computational time needed to
create our visibility graph could be quite large. So, we will want to
limit our land polygon as much as we reasonably can.</p>
<p>We’ll do this by creating a convex hull boundary around our observed
data and limiting the region to this space. Here, we’ll go with a buffer
of 50 km around each point and rely on the buffered features to create
our convex hull. The size of the buffer is case-specific. In this case,
we could likely get away with a smaller buffer if we were only
interested in the connect-the-dot track or a model predication. But,
later, we will also impute additional, possible tracks from the model
fit to better represent model uncertainty. For this reason, we went with
a larger buffer so we only have to create a single network graph.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">land_region</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">harborSeal_sf</span>, dist <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_convex_hull</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">akcoast</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_collection_extract.html" class="external-link">st_collection_extract</a></span><span class="op">(</span><span class="st">'POLYGON'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">l</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">harborSeal_sf</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-9-1.png" alt="Land barrier polygon after limiting to a 50km buffered convex hull of the observation points" width="700"><p class="caption">
Land barrier polygon after limiting to a 50km buffered convex hull of
the observation points
</p>
</div>
</div>
<div class="section level4">
<h4 id="create-visibility-graph">Create Visibility Graph<a class="anchor" aria-label="anchor" href="#create-visibility-graph"></a>
</h4>
<p>At this point, we are ready to create our visibility graph using the
<code><a href="../reference/prt_visgraph.html">pathroutr::prt_visgraph()</a></code> function. We’ll keep
<em>centroids = FALSE</em> in order to speed up the build. Adding
additional centroids will increase the likelihood of linearity in the
calculated shortest path. This is especially true when the shortest path
crosses larger areas of open water. However, adding the additional
centroids results in a very large increase in computational time (both
in creation of the visual graph and in subsequent operations). There is
likely little improvement in situations where the shortest path routing
follows the coast. The default setting is <em>centroids=FALSE</em>. If a
user chooses to set <em>centroids=TRUE</em>, we strongly encourage
setting <em>centroid_limit</em> to a large value (default is
<em>1e+07</em>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prt_visgraph.html">prt_visgraph</a></span><span class="op">(</span><span class="va">land_region</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at our network. The network stores both “nodes” and
“edges” and we need to “activate” one or the other before converting to
a simple feature collection.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis_graph_sf</span> <span class="op">&lt;-</span> <span class="fu">sfnetworks</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">vis_graph</span>,<span class="st">"edges"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">vis_graph_sf</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-12-1.png" alt="Visibility graph network edges created with the `{sfnetworks}` package. All vertices from the land polygon were used as nodes in the network and any edges that crossed land were removed." width="700"><p class="caption">
Visibility graph network edges created with the
<a href="https://luukvdmeer.github.io/sfnetworks/" class="external-link">sfnetworks</a> package. All vertices from the land polygon
were used as nodes in the network and any edges that crossed land were
removed.
</p>
</div>
<p>Note the large triangles in the large, open water areas. This is a
key advantage for our purpose as we concentrate the detail of our
network along the coastline where routing of our tracks around land
requires the most detail. The trade-off is that any shortest path
routing that crosses the large, open areas will have less linearity. If
we had set <em>centroids=TRUE</em>, then a centroid point would have
been added to each of these triangles and the mesh would have been
rebuilt to include those points.</p>
</div>
<div class="section level4">
<h4 id="determine-segments-of-track-on-land">Determine Segments of Track On Land<a class="anchor" aria-label="anchor" href="#determine-segments-of-track-on-land"></a>
</h4>
<p>In this example, our interest is to re-route only the portions of the
track that cross land. So, we need to identify the segments of
consecutive points on land and, also, the points in water that bookend
each segment. We will use this information to calculate our shortest
path through our network and create an updated series of point
features.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_pts</span> <span class="op">&lt;-</span> <span class="va">harborSeal_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_query.html" class="external-link">st_is_empty</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">segs_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_barrier_segments.html">get_barrier_segments</a></span><span class="op">(</span><span class="va">track_pts</span>,<span class="va">land_region</span><span class="op">)</span></span>
<span><span class="va">segs_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 6</span></span></span>
<span><span class="co">#&gt;      sid start_idx end_idx n_pts             start_pt</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1        70      72     1  (-7141.435 1009874)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2       211     213     1   (17825.82 1009686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3       296     298     1 (-166514.5 678462.8)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4       299     301     1 (-166385.8 678569.6)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5       310     312     1   (-159772 672617.8)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6       313     315     1 (-168417.8 679098.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7       346     348     1 (-166934.5 680376.9)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8       372     375     2   (-167836 679632.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9       390     392     1   (-164953 673937.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10       398     400     1   (-163341.9 680010)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 34 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: end_pt &lt;POINT [m]&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="determine-re-routed-track-via-shortest-path">Determine Re-routed Track via Shortest Path<a class="anchor" aria-label="anchor" href="#determine-re-routed-track-via-shortest-path"></a>
</h4>
<p>Since our bookend points were not used to create our visibility
graph, we need to also determine the closest network node to each point.
Our <code><a href="../reference/prt_nearestnode.html">prt_nearestnode()</a></code> function relies on the
<code><a href="https://rdrr.io/pkg/nabor/man/knn.html" class="external-link">nabor::knn()</a></code> function for this. The user does not need to
call this explicitly as it is handled within the
<code><a href="../reference/prt_shortpath.html">prt_shortpath()</a></code> function.</p>
<p>Now, we have all the information we need to calculate the shortest
path through our network for each segment. The
<code><a href="https://r.igraph.org/reference/distances.html" class="external-link">igraph::shortest_paths()</a></code> function calculates and returns
the series of edges that make up the shortest path (by distance) from
the start node to the end node. The <code><a href="../reference/prt_shortpath.html">prt_shortpath()</a></code>
function wraps in additional functionality (e.g. blending the network,
identifying the nearest nodes to our start and end points, assembling
the path, extending the path at each end to connect with our bookend
points).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">segs_tbl</span> <span class="op">&lt;-</span> <span class="va">segs_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/prt_shortpath.html">prt_shortpath</a></span><span class="op">(</span><span class="va">vis_graph</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">segs_tbl</span><span class="op">$</span><span class="va">geometry</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-14-1.png" alt="Segments that were identified to cross land have been re-routed along the shortest path throught visibility network" width="700"><p class="caption">
Segments that were identified to cross land have been re-routed along
the shortest path throught visibility network
</p>
</div>
</div>
<div class="section level4">
<h4 id="update-geometry-with-re-routed-coordinates">Update Geometry With Re-routed Coordinates<a class="anchor" aria-label="anchor" href="#update-geometry-with-re-routed-coordinates"></a>
</h4>
<p>In reality, most of the time the user will simply want to provide an
ordered series of points, a barrier polygon, and the spatial network.
<code>{pathroutr}</code> includes a convenience function for this,
<code><a href="../reference/prt_reroute.html">prt_reroute()</a></code>. This will return a two-column tibble with an
index location and geometry for each re-routed point. The user can use
this to update the original data as they see fit. Or, the
<code><a href="../reference/prt_update_points.html">prt_update_points()</a></code> function can be used to replace the
geometry in place. This last step is done by inserting the fixed points
back into our original path. We take the number of points in the
original segment and distribute an equal number of points along the
updated path. Because the geometry in the original dataset is updated in
place, some users may want to create customized functions or workflows
to better track updates to the original data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_pts_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prt_reroute.html">prt_reroute</a></span><span class="op">(</span><span class="va">track_pts</span>, <span class="va">land_region</span>, <span class="va">vis_graph</span><span class="op">)</span></span>
<span></span>
<span><span class="va">track_pts_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prt_update_points.html">prt_update_points</a></span><span class="op">(</span><span class="va">track_pts_fix</span>, <span class="va">track_pts</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_line_fixed</span> <span class="op">&lt;-</span> <span class="va">track_pts_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">'LINESTRING'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">track_line_fixed</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">track_pts_fix</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-16-1.png" alt="Raw Argos observation geometries updated in place with the re-routed paths" width="700"><p class="caption">
Raw Argos observation geometries updated in place with the re-routed
paths
</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="re-routing-a-movement-model-prediction">Re-Routing a Movement Model Prediction<a class="anchor" aria-label="anchor" href="#re-routing-a-movement-model-prediction"></a>
</h3>
<p>Now, we’ll move on to the preferred workflow and establish a movement
model from our raw location observations.</p>
<p>Here, we rely on an example from the <code>{crawl}</code> package.
But, other model approaches (e.g. <code>{foieGras}</code>) should work
as well. We have plans to provide specific methods for a variety of
model outputs in future releases.</p>
<div class="section level4">
<h4 id="fit-movement-model-and-predict-locations">Fit Movement Model and Predict Locations<a class="anchor" aria-label="anchor" href="#fit-movement-model-and-predict-locations"></a>
</h4>
<p>As you might have noticed when we re-routed our raw observations, the
trackline derived from those points can still cross land. This is
because we only control for the presence of observation points on land.
At the irregular and sometimes large time intervals common to location
data for marine mammals, this cannot be avoided. However, once we have a
movement model, we can predicted a finer location intervals and limit
this possibility. You will notice in this example, the prediction
interval is every 15 minutes.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Fit model as given in Johnson et al. (2008) Ecology 89:1208-1215</span></span>
<span><span class="co">## Start values for theta come from the estimates in Johnson et al. (2008)</span></span>
<span><span class="va">fixPar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">250</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/crawl/man/displayPar.html" class="external-link">displayPar</a></span><span class="op">(</span> mov.model<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, err.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">~</span><span class="va">Argos_loc_class</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,data<span class="op">=</span><span class="va">harborSeal_sf</span>, </span>
<span>            activity<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">DryTime</span><span class="op">)</span>,fixPar<span class="op">=</span><span class="va">fixPar</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  ParNames   fixPar thetaIdx</span></span>
<span><span class="co">#&gt; 1 ln tau Argos_loc_class0 5.521461       NA</span></span>
<span><span class="co">#&gt; 2 ln tau Argos_loc_class1 6.214608       NA</span></span>
<span><span class="co">#&gt; 3 ln tau Argos_loc_class2 7.313220       NA</span></span>
<span><span class="co">#&gt; 4 ln tau Argos_loc_class3       NA        1</span></span>
<span><span class="co">#&gt; 5 ln tau Argos_loc_classA       NA        2</span></span>
<span><span class="co">#&gt; 6 ln tau Argos_loc_classB       NA        3</span></span>
<span><span class="co">#&gt; 7    ln sigma (Intercept)       NA        4</span></span>
<span><span class="co">#&gt; 8     ln beta (Intercept)       NA        5</span></span>
<span><span class="co">#&gt; 9                  ln phi 0.000000       NA</span></span>
<span><span class="va">constr</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1500</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">Inf</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crwMLE.html" class="external-link">crwMLE</a></span><span class="op">(</span></span>
<span>  mov.model<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, err.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">~</span><span class="va">Argos_loc_class</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, activity<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">DryTime</span><span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="va">harborSeal_sf</span>,  Time.name<span class="op">=</span><span class="st">"Time"</span>, </span>
<span>  fixPar<span class="op">=</span><span class="va">fixPar</span>, theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fl">3600</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  constr<span class="op">=</span><span class="va">constr</span>, method<span class="op">=</span><span class="st">"L-BFGS-B"</span>,</span>
<span>  control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">2000</span>, trace<span class="op">=</span><span class="fl">1</span>, REPORT<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Beginning SANN initialization ...</span></span>
<span><span class="co">#&gt; Beginning likelihood optimization ...</span></span>
<span><span class="co">#&gt; iter    1 value 41202.609844</span></span>
<span><span class="co">#&gt; iter    2 value 41056.998394</span></span>
<span><span class="co">#&gt; iter    3 value 40756.499672</span></span>
<span><span class="co">#&gt; iter    4 value 40146.411888</span></span>
<span><span class="co">#&gt; iter    5 value 40066.268387</span></span>
<span><span class="co">#&gt; iter    6 value 40005.050127</span></span>
<span><span class="co">#&gt; iter    7 value 40001.092459</span></span>
<span><span class="co">#&gt; iter    8 value 40001.050325</span></span>
<span><span class="co">#&gt; iter    9 value 40001.048541</span></span>
<span><span class="co">#&gt; iter   10 value 40001.048534</span></span>
<span><span class="co">#&gt; final  value 40001.048534 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span></span>
<span><span class="va">pred1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crwPredict.html" class="external-link">crwPredict</a></span><span class="op">(</span><span class="va">fit1</span>, predTime <span class="op">=</span> <span class="st">'15 min'</span><span class="op">)</span></span>
<span><span class="va">pred1_sf</span> <span class="op">&lt;-</span> <span class="va">pred1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crw_as_sf.html" class="external-link">crw_as_sf</a></span><span class="op">(</span><span class="st">"POINT"</span>,<span class="st">"p"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="identify-predicted-locations-on-land">Identify Predicted Locations on Land<a class="anchor" aria-label="anchor" href="#identify-predicted-locations-on-land"></a>
</h4>
<p>As before, we need to identify all of the segments of consecutive
locations on land and determine the associated start and end nodes
within our network.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">segs_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_barrier_segments.html">get_barrier_segments</a></span><span class="op">(</span><span class="va">pred1_sf</span>,<span class="va">land_region</span><span class="op">)</span></span>
<span><span class="va">segs_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 140 × 6</span></span></span>
<span><span class="co">#&gt;      sid start_idx end_idx n_pts             start_pt</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1      <span style="text-decoration: underline;">2</span>426    <span style="text-decoration: underline;">2</span>435     8   (16195.24 1008923)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2      <span style="text-decoration: underline;">2</span>482    <span style="text-decoration: underline;">2</span>485     2   (13845.85 1009221)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3      <span style="text-decoration: underline;">2</span>486    <span style="text-decoration: underline;">2</span>488     1   (14334.24 1007460)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4      <span style="text-decoration: underline;">2</span>488    <span style="text-decoration: underline;">2</span>557    68   (14625.18 1006411)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5      <span style="text-decoration: underline;">2</span>648    <span style="text-decoration: underline;">2</span>651     2    (47203.07 912631)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6      <span style="text-decoration: underline;">2</span>656    <span style="text-decoration: underline;">2</span>662     5  (44653.54 904336.9)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7      <span style="text-decoration: underline;">3</span>260    <span style="text-decoration: underline;">3</span>263     2 (-169713.6 678313.5)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8      <span style="text-decoration: underline;">3</span>524    <span style="text-decoration: underline;">3</span>531     6   (-166814 672859.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9      <span style="text-decoration: underline;">3</span>545    <span style="text-decoration: underline;">3</span>564    18 (-166337.5 678529.5)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10      <span style="text-decoration: underline;">3</span>610    <span style="text-decoration: underline;">3</span>616     5 (-166162.5 678383.6)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 130 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: end_pt &lt;POINT [m]&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="re-route-model-prediction-via-shortest-path">Re-route Model Prediction via Shortest Path<a class="anchor" aria-label="anchor" href="#re-route-model-prediction-via-shortest-path"></a>
</h4>
<p>And just like we did with the raw observations, we use the
<code><a href="../reference/prt_shortpath.html">prt_shortpath()</a></code> function to calculate all of our re-routed
paths</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">segs_tbl</span> <span class="op">&lt;-</span> <span class="va">segs_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/prt_shortpath.html">prt_shortpath</a></span><span class="op">(</span><span class="va">vis_graph</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">segs_tbl</span><span class="op">$</span><span class="va">geometry</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-19-1.png" alt="Re-routed segments from the predicted path" width="700"><p class="caption">
Re-routed segments from the predicted path
</p>
</div>
</div>
<div class="section level4">
<h4 id="update-predicted-path">Update Predicted Path<a class="anchor" aria-label="anchor" href="#update-predicted-path"></a>
</h4>
<p>As in the first example, we could have skipped these last few steps
and just relied on the <code><a href="../reference/prt_reroute.html">prt_reroute()</a></code> and
<code><a href="../reference/prt_update_points.html">prt_update_points()</a></code> functions.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_pts_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prt_reroute.html">prt_reroute</a></span><span class="op">(</span><span class="va">pred1_sf</span>, <span class="va">land_region</span>, <span class="va">vis_graph</span><span class="op">)</span></span>
<span></span>
<span><span class="va">track_pts_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prt_update_points.html">prt_update_points</a></span><span class="op">(</span><span class="va">track_pts_fix</span>, <span class="va">pred1_sf</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_line_fixed</span> <span class="op">&lt;-</span> <span class="va">track_pts_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">'LINESTRING'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">track_line_fixed</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-21-1.png" alt="Updated predicted path with re-routed geometries" width="700"><p class="caption">
Updated predicted path with re-routed geometries
</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="multiple-imputation">Multiple Imputation<a class="anchor" aria-label="anchor" href="#multiple-imputation"></a>
</h3>
<p>The recommended analytic workflow for <code>{crawl}</code> movement
models is to characterize movement from a collection of imputed paths
from the model fit. The <code>{pathroutr}</code> re-routing can be
applied to each of these imputed paths and, hopefully, provide a more
complete picture of uncertainty.</p>
<div class="section level4">
<h4 id="create-multiple-imputations-from-crawl-model">Create Multiple Imputations from {crawl} Model<a class="anchor" aria-label="anchor" href="#create-multiple-imputations-from-crawl-model"></a>
</h4>
<p>We will use the <code><a href="https://rdrr.io/pkg/crawl/man/crwSimulator.html" class="external-link">crawl::crwSimulator()</a></code> and
<code><a href="https://rdrr.io/pkg/crawl/man/crwPostIS.html" class="external-link">crawl::crwPostIS()</a></code> functions to create our imputed paths.
The code below is a more tidyverse-centric approach that relies on
<code><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">dplyr::rowwise()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> to draw
and, then, re-route 5 imputed paths. Note, here, we set
<code>blend = FALSE</code> for the <code><a href="../reference/prt_reroute.html">prt_reroute()</a></code> function
call. This is just to save some computation time for this example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crw_sim</span> <span class="op">&lt;-</span> <span class="fu">crawl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crwSimulator.html" class="external-link">crwSimulator</a></span><span class="op">(</span><span class="va">fit1</span>, predTime <span class="op">=</span> <span class="st">"15 min"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing importance weights ...</span></span>
<span></span>
<span><span class="va">imputes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>.rows <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>postis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crwPostIS.html" class="external-link">crwPostIS</a></span><span class="op">(</span><span class="va">crw_sim</span>, fullPost <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/crawl/man/crw_as_sf.html" class="external-link">crw_as_sf</a></span><span class="op">(</span><span class="va">postis</span>, locType <span class="op">=</span> <span class="st">"p"</span>, ftype <span class="op">=</span> <span class="st">"POINT"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         rrt_pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/prt_reroute.html">prt_reroute</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">land_region</span>, <span class="va">vis_graph</span>, blend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         pts_fix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/prt_update_points.html">prt_update_points</a></span><span class="op">(</span><span class="va">rrt_pts</span>, <span class="va">pts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         lines_fix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pts_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">'LINESTRING'</span><span class="op">)</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="va">sim_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">imputes</span><span class="op">$</span><span class="va">lines_fix</span><span class="op">)</span></span></code></pre></div>
<p>The figure below combines our predicted path and the collection of
five imputed paths. Note the routing of tracks around the land barrier
features for both the predicted track and the imputed tracks. One thing
to keep in mind is that the imputed tracks will often have less linear
inertia and, thus, a greater number of small land crossings. This means
re-routing any one of the imputed tracks will likely take longer than
the predicted path. The exact number of imputed paths needed will be
case specific. However, more than 20 is likely not needed.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">sim_lines</span>, color <span class="op">=</span> <span class="st">"deepskyblue"</span>, alpha <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">track_line_fixed</span>, color <span class="op">=</span> <span class="st">"deepskyblue3"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="akharborseal_demo_files/figure-html/unnamed-chunk-23-1.png" alt="Five imputed paths are shown along with the predicted most likely path after re-routing around the land barrier." width="700"><p class="caption">
Five imputed paths are shown along with the predicted most likely path
after re-routing around the land barrier.
</p>
</div>
</div>
<div class="section level4">
<h4 id="space-use-analysis">Space Use Analysis<a class="anchor" aria-label="anchor" href="#space-use-analysis"></a>
</h4>
<p>Understanding space use is a common goal for telemetry data like is
presented in this example. Since the movement model allows us to predict
at regular intervals, we can use the count of predicted points within a
regular grid to represent space use. And, by averaging the count across
multiple imputed paths we can create a space use surface that
incorporates our uncertainty.</p>
<p>First thing we’ll want to do is to create a regular grid for our the
bounding box of our study area. It is important to base this grid on
<code>sim_lines</code> so that we have complete spatial coverage for our
imputed tracks. We’ll use a hexagonal grid and remove all of the grid
cells that fall within our land polygon. This will leave those cells
that are completely over water or that touch or overlap the
coastline.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hex_grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">sim_lines</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  cellsize <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  square <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">land_region</span><span class="op">)</span>, .predicate <span class="op">=</span> <span class="fu">pathroutr</span><span class="fu">:::</span><span class="va"><a href="../reference/spatial_predicates.html">not_within</a></span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"hexid"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we need to join our fixed points from our imputations
(<code>imputes$pts_fix</code>) to our <code>hex_grid</code> and count
the number of points per grid cell.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Suppress summarise info</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hexbins</span> <span class="op">&lt;-</span> <span class="va">imputes</span><span class="op">$</span><span class="va">pts_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">hex_grid</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">hexid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">hex_grid</span>, by <span class="op">=</span> <span class="st">"hexid"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>For our seal-use statistics, we’ll want to average our counts per
grid cell across each of the imputed tracks. We will also calculate
standard deviation, CV, and a normalized CV that we will use in our plot
to communicate uncertainty.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seal_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">hexbins</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">hexid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, n_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_mean</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_cv <span class="op">=</span> <span class="va">n_sd</span><span class="op">/</span><span class="va">n_mean</span>,</span>
<span>                n_cv2 <span class="op">=</span> <span class="va">n_cv</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_cv</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Our final plot of seal use is presented on a log10 scale and the
transparency is set based on our normalized CV such that cells with
higher uncertainty are more transparent.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">annotation_spatial</a></span><span class="op">(</span><span class="va">land_region</span>, fill <span class="op">=</span> <span class="st">"cornsilk3"</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggspatial</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/layer_spatial.html" class="external-link">layer_spatial</a></span><span class="op">(</span><span class="va">seal_use</span>, </span>
<span>                           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">n_mean</span>, alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">n_cv2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="akharborseal_demo_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josh London.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
